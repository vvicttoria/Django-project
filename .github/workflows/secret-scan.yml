name: Check for Secrets

on: push

env:
  SCANNER_ARGS: |
      --all-files
      --base64-limit 2.5
      --hex-limit 2.0
      --disable-filter allowlist
      -p HighEntropyString
      -p EnvFileDetector
      -p KeywordDetector

jobs:
  check-secrets:
    name: Secret Scanning
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install detect-secrets
        run: |
          pip install detect-secrets

      - name: Run detect-secrets scan
        run: |
          detect-secrets scan ${{ env.SCANNER_ARGS }}
        continue-on-error: true

      - name: Review Detected Secrets
        if: failure()
        run: |
          echo "Secrets detected! Please review the report."
